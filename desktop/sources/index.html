<!DOCTYPE html>
<html>
  <head>
    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
    <script type="text/javascript">const THREE = require('three');</script>
    <script type="text/javascript" src="scripts/lib/logo.js"></script>
    <script type="text/javascript" src="scripts/lib/stats.min.js"></script>
    <script type="text/javascript" src="scripts/lib/easing.js"></script>
    <script type="text/javascript" src="scripts/lib/theme.js"></script>
    <script type="text/javascript" src="scripts/lib/controller.js"></script>
    <script type="text/javascript" src="scripts/lib/arvelie.js"></script>
    <script type="text/javascript" src="scripts/lib/neralie.js"></script>
    <script type="text/javascript" src="scripts/lib/lisp.js"></script>
    <script type="text/javascript" src="scripts/lib/lisp.lib.js"></script>

    <script type="text/javascript" src="scripts/utils/tools.js"></script>
    <script type="text/javascript" src="scripts/utils/meshlinesegments.js"></script>

    <script type="text/javascript" src="scripts/animations/animator.js"></script>
    <script type="text/javascript" src="scripts/animations/animation.js"></script>
    <script type="text/javascript" src="scripts/animations/animatedproperty.js"></script>
    <script type="text/javascript" src="scripts/animations/animatedxyz.js"></script>

    <script type="text/javascript" src="scripts/components/scenenode.js"></script>
    <script type="text/javascript" src="scripts/components/empty.js"></script>
    <script type="text/javascript" src="scripts/components/scenedrawnode.js"></script>
    <script type="text/javascript" src="scripts/components/sceneline.js"></script>
    <script type="text/javascript" src="scripts/components/scenelabel.js"></script>
    <script type="text/javascript" src="scripts/components/scenebutton.js"></script>
    <script type="text/javascript" src="scripts/components/sceneprogressbar.js"></script>
    <script type="text/javascript" src="scripts/components/sceneprogressradial.js"></script>
    <script type="text/javascript" src="scripts/components/sceneport.js"></script>
    <script type="text/javascript" src="scripts/components/scenetrigger.js"></script>
    <script type="text/javascript" src="scripts/components/scenewire.js"></script>
    <script type="text/javascript" src="scripts/components/sceneportslot.js"></script>
    <script type="text/javascript" src="scripts/components/scenehandle.js"></script>
    <script type="text/javascript" src="scripts/components/sceneportredirect.js"></script>

    <script type="text/javascript" src="scripts/shapes/diamond.js"></script>
    <script type="text/javascript" src="scripts/shapes/octagon.js"></script>
    <script type="text/javascript" src="scripts/shapes/hexagon.js"></script>
    <script type="text/javascript" src="scripts/shapes/rect.js"></script>
    <script type="text/javascript" src="scripts/shapes/cube.js"></script>
    <script type="text/javascript" src="scripts/shapes/spaceship.js"></script>

    <script type="text/javascript" src="scripts/core/verreciel.js"></script>
    <script type="text/javascript" src="scripts/core/music.js"></script>

    <script type="text/javascript" src="scripts/core/ghost.js"></script>
    <script type="text/javascript" src="scripts/core/universe.js"></script>
    <script type="text/javascript" src="scripts/core/game.js"></script>
    <script type="text/javascript" src="scripts/core/player.js"></script>
    <script type="text/javascript" src="scripts/core/helmet.js"></script>
    <script type="text/javascript" src="scripts/core/capsule.js"></script>
    <script type="text/javascript" src="scripts/core/space.js"></script>

    <script type="text/javascript" src="scripts/objects/event.js"></script>
    <script type="text/javascript" src="scripts/objects/icon.js"></script>
    <script type="text/javascript" src="scripts/objects/item.js"></script>
    <script type="text/javascript" src="scripts/objects/mission.js"></script>
    <script type="text/javascript" src="scripts/objects/recipe.js"></script>
    <script type="text/javascript" src="scripts/objects/quest.js"></script>

    <script type="text/javascript" src="scripts/objects/structure.js"></script>

    <script type="text/javascript" src="scripts/panels/panel.js"></script>
    <script type="text/javascript" src="scripts/panels/portholes/above.js"></script>
    <script type="text/javascript" src="scripts/panels/portholes/below.js"></script>

    <script type="text/javascript" src="scripts/panels/mainpanels/mainpanel.js"></script>
    <script type="text/javascript" src="scripts/panels/mainpanels/battery.js"></script>
    <script type="text/javascript" src="scripts/panels/mainpanels/cargo.js"></script>
    <script type="text/javascript" src="scripts/panels/mainpanels/console.js"></script>
    <script type="text/javascript" src="scripts/panels/mainpanels/hatch.js"></script>
    <script type="text/javascript" src="scripts/panels/mainpanels/intercom.js"></script>
    <script type="text/javascript" src="scripts/panels/mainpanels/pilot.js"></script>
    <script type="text/javascript" src="scripts/panels/mainpanels/radar.js"></script>
    <script type="text/javascript" src="scripts/panels/mainpanels/thruster.js"></script>

    <script type="text/javascript" src="scripts/panels/monitors/monitor.js"></script>
    <script type="text/javascript" src="scripts/panels/monitors/journey.js"></script>
    <script type="text/javascript" src="scripts/panels/monitors/exploration.js"></script>
    <script type="text/javascript" src="scripts/panels/monitors/progress.js"></script>
    <script type="text/javascript" src="scripts/panels/monitors/complete.js"></script>

    <script type="text/javascript" src="scripts/panels/widgets/widget.js"></script>
    <script type="text/javascript" src="scripts/panels/widgets/radio.js"></script>
    <script type="text/javascript" src="scripts/panels/widgets/nav.js"></script>
    <script type="text/javascript" src="scripts/panels/widgets/shield.js"></script>
    <script type="text/javascript" src="scripts/panels/widgets/enigma.js"></script>
    
    <script type="text/javascript" src="scripts/locations/location.js"></script>
    <script type="text/javascript" src="scripts/locations/bank.js"></script>
    <script type="text/javascript" src="scripts/locations/beacon.js"></script>
    <script type="text/javascript" src="scripts/locations/close.js"></script>
    <script type="text/javascript" src="scripts/locations/constellation.js"></script>
    <script type="text/javascript" src="scripts/locations/harvest.js"></script>
    <script type="text/javascript" src="scripts/locations/horadric.js"></script>
    <script type="text/javascript" src="scripts/locations/portal.js"></script>
    <script type="text/javascript" src="scripts/locations/satellite.js"></script>
    <script type="text/javascript" src="scripts/locations/star.js"></script>
    <script type="text/javascript" src="scripts/locations/station.js"></script>
    <script type="text/javascript" src="scripts/locations/trade.js"></script>
    <script type="text/javascript" src="scripts/locations/transit.js"></script>
    <script type="text/javascript" src="scripts/locations/antenna.js"></script>
    <script type="text/javascript" src="scripts/locations/radar.js"></script>

    <script type="text/javascript" src="scripts/collections/missions.js"></script>
    <script type="text/javascript" src="scripts/collections/items.js"></script>
    <script type="text/javascript" src="scripts/collections/locations.js"></script>
    <script type="text/javascript" src="scripts/collections/recipes.js"></script>

    <link rel="stylesheet" type="text/css" href="links/reset.css"/>
    <link rel="stylesheet" type="text/css" href="links/main.css"/>
    <title>Verreciel</title>
  </head>
  <body>
    <script>
      const remote = require('electron').remote;
      const {dialog,app} = remote;
      const fs = require('fs');

      function isDeviceMobile()
      {
        console.log("isDeviceMobile: window orientation = " + window.orientation);
        return window.orientation !== undefined;
      }

      let JUMP_MISSION = remote.getGlobal('query')[0] === 'mission' ? remote.getGlobal('query')[1] : null

      let IS_MOBILE = isDeviceMobile();
      let DEBUG_SKIP_LOGO = JUMP_MISSION ? true : false;
      let DEBUG_SHOW_TRIGGERS = false;
      let DEBUG_LOG_GHOST = false;
      let DEBUG_DONT_SAVE = false;
      let DEBUG_NO_MUSIC = false;
      let DEBUG_SHOW_STATS = false;
      let DEBUG_REPORT_NODE_USE = false;

      let verreciel = new Verreciel();
      verreciel.install();

      verreciel.controller.add('default', '*', 'About', () => { require('electron').shell.openExternal('http://hundredrabbits.itch.io/Verreciel') }, 'CmdOrCtrl+,')
      verreciel.controller.add('default', '*', 'Fullscreen', () => { app.toggleFullscreen() }, 'CmdOrCtrl+Enter')
      verreciel.controller.add('default', '*', 'Hide', () => { app.toggleVisible() }, 'CmdOrCtrl+H')
      verreciel.controller.add('default', '*', 'Inspect', () => { app.inspect() }, 'CmdOrCtrl+.')
      verreciel.controller.add('default', '*', 'Documentation', () => { verreciel.controller.docs() }, 'CmdOrCtrl+Esc')
      verreciel.controller.add('default', '*', 'Reset', () => { verreciel.reset(); app.exit() }, 'CmdOrCtrl+Shift+Backspace')
      verreciel.controller.add('default', '*', 'Quit', () => { app.exit() }, 'CmdOrCtrl+Q')
      verreciel.controller.add('default', 'Look', 'Release Hand', () => { verreciel.player.releasePort() }, 'Esc')
      verreciel.controller.add('default', 'Look', 'Battery', () => { verreciel.player.lookAt(0) }, '1')
      verreciel.controller.add('default', 'Look', 'Radar', () => { verreciel.player.lookAt(180) }, '2')
      verreciel.controller.add('default', 'Look', 'Monitor', () => { verreciel.player.lookAt(90) }, '3')
      verreciel.controller.add('default', 'Look', 'East', () => { verreciel.player.lookAt(-90) }, '4')
      verreciel.controller.add('default', 'Look', 'Right', () => { verreciel.player.lookAtMod(90) }, '5')
      verreciel.controller.add('default', 'Look', 'Left', () => { verreciel.player.lookAtMod(-90) }, '6')
      verreciel.controller.add('default', 'Audio', 'Toggle Ambience', () => { verreciel.music.toggleAmbience() }, 'CmdOrCtrl+Shift+M')
      verreciel.controller.add('default', 'Theme', 'Open Theme', () => { this.theme.open() }, 'CmdOrCtrl+Shift+O')
      verreciel.controller.add('default', 'Theme', 'Reset Theme', () => { this.theme.reset() }, 'CmdOrCtrl+Shift+Backspace')
      verreciel.controller.addSpacer('default', 'Theme', 'Download')
      verreciel.controller.add('default', 'Theme', 'Download Themes..', () => { require('electron').shell.openExternal('https://github.com/hundredrabbits/Themes') })
      verreciel.controller.commit()

      if (DEBUG_SKIP_LOGO) {
        verreciel.start(JUMP_MISSION);
      }
      else {
        var logo = new Logo();
        logo.install(120);
        setTimeout(function(){ verreciel.start(); }, 3000);
        setTimeout(function(){ logo.remove(); }, 5500);
      }

      window.addEventListener("keydown", verreciel.player.onKey);

    </script>
  </body>
</html>
